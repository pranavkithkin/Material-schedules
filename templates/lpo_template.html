<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchase Order - {{ lpo_number }}</title>
    <style>
        @page {
            size: A4;
            margin: 0.8cm 1cm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 9pt;
            line-height: 1.2;
            color: #000;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 5px;
            border-bottom: 2px solid #000;
            padding-bottom: 5px;
        }
        
        .header h1 {
            font-size: 18pt;
            font-weight: bold;
            margin: 0;
            padding: 0;
        }
        
        /* Info Table */
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            font-size: 8pt;
        }
        
        .info-table td {
            padding: 2px 5px;
            vertical-align: top;
        }
        
        .info-label {
            font-weight: bold;
            white-space: nowrap;
            width: 12%;
        }
        
        .info-value {
            width: 21%;
        }
        
        /* Items Table */
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0 5px 0;
            font-size: 8pt;
        }
        
        .items-table thead {
            background-color: #000;
            color: #fff;
        }
        
        .items-table th {
            padding: 4px 3px;
            text-align: left;
            font-weight: bold;
            border: 1px solid #000;
        }
        
        .items-table td {
            padding: 3px;
            border: 1px solid #999;
            vertical-align: top;
        }
        
        .items-table .col-item { width: 3%; text-align: center; }
        .items-table .col-code { width: 8%; }
        .items-table .col-desc { width: 35%; }
        .items-table .col-unit { width: 6%; text-align: center; }
        .items-table .col-qty { width: 5%; text-align: right; }
        .items-table .col-price { width: 10%; text-align: right; }
        .items-table .col-vat { width: 8%; text-align: right; }
        .items-table .col-amount { width: 10%; text-align: right; }
        
        /* Totals Section */
        .totals-section {
            margin: 10px 0;
            font-size: 9pt;
        }
        
        .totals-table {
            width: 350px;
            margin-left: auto;
            border-collapse: collapse;
        }
        
        .totals-table td {
            padding: 3px 8px;
        }
        
        .totals-label {
            font-weight: bold;
            text-align: left;
        }
        
        .totals-value {
            text-align: right;
            min-width: 100px;
        }
        
        .totals-words {
            font-size: 8pt;
            margin-top: 3px;
            text-align: right;
        }
        
        /* Terms Section */
        .terms-section {
            margin: 10px 0;
            font-size: 8pt;
        }
        
        .terms-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .terms-table td {
            padding: 2px 5px;
        }
        
        .terms-label {
            font-weight: bold;
            width: 15%;
        }
        
        .terms-content {
            padding-left: 15px;
        }
        
        /* Signature Section */
        .signature-section {
            margin: 25px 0 15px 0;
            font-size: 9pt;
        }
        
        .signature-box {
            display: inline-block;
            width: 48%;
        }
        
        .signature-box.right {
            float: right;
        }
        
        .signature-label {
            font-weight: bold;
        }
        
        /* Footer */
        .footer {
            margin-top: 15px;
            padding-top: 8px;
            border-top: 1px solid #000;
            text-align: center;
            font-size: 7pt;
            line-height: 1.4;
        }
        
        .footer p {
            margin: 2px 0;
        }
        
        .footer-company {
            font-weight: bold;
            font-size: 8pt;
        }
        
        .footer-auto {
            text-align: right;
            font-style: italic;
            margin-top: 5px;
            font-size: 7pt;
        }
        
        /* Page Break */
        .page-break {
            page-break-after: always;
        }
        
        /* Multi-page header (for pages after first) */
        .continued-header {
            display: none; /* Only show on subsequent pages */
        }
        
        @media print {
            .continued-header {
                display: block;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <h1>PURCHASE ORDER</h1>
    </div>
    
    <!-- LPO INFORMATION TABLE -->
    <table class="info-table">
        <tr>
            <td class="info-label">LPO No:</td>
            <td class="info-value">{{ lpo_number }}</td>
            <td class="info-label">DATE</td>
            <td class="info-value">{{ lpo_date }}</td>
            <td class="info-label">SUBMITTAL REFNo:</td>
            <td class="info-value">{{ submittal_ref|default('-', true) }}</td>
        </tr>
        <tr>
            <td class="info-label">PROJECT:</td>
            <td class="info-value" colspan="3">{{ project_name }}</td>
            <td class="info-label">PROJECT A/CNo:</td>
            <td class="info-value">{{ project_account }}</td>
        </tr>
        <tr>
            <td class="info-label">REQUESTED BY:</td>
            <td class="info-value" colspan="3">{{ requested_by }}</td>
            <td class="info-label">SITE CONTACT No:</td>
            <td class="info-value">{{ site_contact }}</td>
        </tr>
        <tr>
            <td class="info-label">SUPPLIED BY:</td>
            <td class="info-value" colspan="3">{{ supplier_name }}</td>
            <td class="info-label">TEL No:</td>
            <td class="info-value">{{ supplier_tel }}</td>
        </tr>
        <tr>
            <td class="info-label">QUOTATION REF.</td>
            <td class="info-value">{{ quotation_ref }}</td>
            <td class="info-label"></td>
            <td class="info-value"></td>
            <td class="info-label">DATE:</td>
            <td class="info-value">{{ quotation_date }}</td>
        </tr>
        <tr>
            <td class="info-label">ADDRESS:</td>
            <td class="info-value" colspan="3">{{ supplier_address }}</td>
            <td class="info-label">FAX:</td>
            <td class="info-value">{{ supplier_fax|default('', true) }}</td>
        </tr>
        <tr>
            <td class="info-label">TRN NO</td>
            <td class="info-value">{{ supplier_trn }}</td>
            <td class="info-label"></td>
            <td class="info-value"></td>
            <td class="info-label">PROJECT LOCATION</td>
            <td class="info-value">{{ project_location }}</td>
        </tr>
        <tr>
            <td class="info-label">CONTACT PERSON:</td>
            <td class="info-value">{{ contact_person }}</td>
            <td class="info-label"></td>
            <td class="info-value"></td>
            <td class="info-label">CONTACT NO:</td>
            <td class="info-value">{{ contact_number }}</td>
        </tr>
    </table>
    
    <!-- ITEMS TABLE - Dynamic Columns Based on Supplier Quote -->
    <table class="items-table">
        <thead>
            <tr>
                <th class="col-item">Item</th>
                {% for col in column_structure %}
                    {% if col.upper() not in ['ITEM', 'S.N', 'SN', 'AMOUNT', 'AMOUNT (AED)'] %}
                        <th>{{ col }}</th>
                    {% endif %}
                {% endfor %}
                <th class="col-amount">AMOUNT (AED)</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td class="col-item">{{ item.number or loop.index }}</td>
                {% for col in column_structure %}
                    {% if col.upper() not in ['ITEM', 'S.N', 'SN', 'AMOUNT', 'AMOUNT (AED)'] %}
                        <td {% if col.upper() in ['QTY', 'QUANTITY', 'UNIT PRICE', 'RATE', '5%', 'VAT'] %}class="col-qty"{% endif %}>
                            {{ item.get(col.lower().replace(' ', '_').replace('.', '')) or item.get(col) or '-' }}
                        </td>
                    {% endif %}
                {% endfor %}
                <td class="col-amount">{{ "{:,.2f}".format(item.total_amount or 0) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- TOTALS SECTION -->
    <div class="totals-section">
        <table class="totals-table">
            <tr>
                <td class="totals-label">Total AED</td>
                <td class="totals-value">{{ "{:,.2f}".format(subtotal) }}</td>
            </tr>
            {% if discount and discount > 0 %}
            <tr>
                <td class="totals-label">Discount</td>
                <td class="totals-value">{{ "{:,.2f}".format(discount) }}</td>
            </tr>
            <tr>
                <td class="totals-label">Grand Total AED</td>
                <td class="totals-value">{{ "{:,.2f}".format(grand_total) }}</td>
            </tr>
            {% endif %}
            <tr>
                <td class="totals-label">Vat 5%</td>
                <td class="totals-value">{{ "{:,.2f}".format(vat_amount) }}</td>
            </tr>
            <tr style="border-top: 1px solid #000;">
                <td class="totals-label"><strong>Grand Total (AED):</strong></td>
                <td class="totals-value"><strong>{{ "{:,.2f}".format(grand_total) }}</strong></td>
            </tr>
        </table>
        <div class="totals-words">{{ grand_total_words }}</div>
    </div>
    
    <!-- TERMS AND CONDITIONS -->
    <div class="terms-section">
        <table class="terms-table">
            <tr>
                <td class="terms-label">Payment Terms :</td>
                <td>{{ payment_terms }}</td>
            </tr>
            {% if terms_conditions %}
            <tr>
                <td class="terms-label" style="vertical-align: top;">Terms & Conditions</td>
                <td></td>
            </tr>
            {% for term in terms_conditions.split('\n') %}
            <tr>
                <td></td>
                <td class="terms-content">{{ term }}</td>
            </tr>
            {% endfor %}
            {% endif %}
            <tr>
                <td class="terms-label">SITE LOCATION</td>
                <td>{{ site_location }}</td>
            </tr>
            <tr>
                <td class="terms-label">DELIVERY DATE</td>
                <td>{{ delivery_date }}</td>
            </tr>
        </table>
    </div>
    
    <!-- SIGNATURE SECTION -->
    <div class="signature-section">
        <div class="signature-box">
            <span class="signature-label">PREPARED BY:</span> {{ prepared_by }}
        </div>
        <div class="signature-box right">
            <span class="signature-label">APPROVED BY:</span> {{ approved_by }}
        </div>
        <div style="clear: both;"></div>
    </div>
    
    <!-- FOOTER -->
    <div class="footer">
        <p class="footer-company">PKP Contracting.LLC</p>
        <p>P.O Box. 14953 | Ajman | United Arab Emirates | www.pkpgroups.co.in</p>
        <p>E: info@pkpeng.com | T: +971 6-7311515 | F: +971 6-7311516</p>
        <p>TRN No. 100074132000003</p>
        <div class="footer-auto">* Auto generated</div>
    </div>
</body>
</html>
